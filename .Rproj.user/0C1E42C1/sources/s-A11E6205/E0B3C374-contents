---
title: "002165700, Assignment 4: Query a Database with SQL"
output: html_notebook
---

<!-- the fpath will have to be changed accordingly for this notebook to execute  -->
```{r}
library(RSQLite)
fpath="/Users/poojanangude/Desktop/courses/CS5200_DBMS/Assignment4/"
dbfile="MediaDB.db"

dbcon <- dbConnect(RSQLite::SQLite(),paste0(fpath,dbfile))
```


<!-- 1. What are the last names, city, and state of all customer who made at least one purchase? -->
```{sql connection=dbcon}
SELECT DISTINCT c.LastName, c.City, c.State 
FROM customers AS c 
INNER JOIN invoices AS i ON c.CustomerId=i.CustomerId;
```

<!-- 2. What are the titles of each albums and the artists who created it?? -->
```{sql connection=dbcon}
SELECT al.Title AS 'Album Title', ar.Name AS 'Artist Name'
FROM albums AS al 
INNER JOIN artists AS ar on al.ArtistId=ar.ArtistId;
```

<!-- 3. What are the total number of unique customers for each country, ordered alphabetically by country who made at least one purchase? -->
```{sql connection=dbcon}
SELECT c.Country, COUNT(DISTINCT c.CustomerId) as 'Number of Unique Customers' FROM customers AS c 
INNER JOIN invoices AS i on c.CustomerId=i.CustomerId 
GROUP BY c.Country 
HAVING COUNT(DISTINCT c.CustomerId)>=1;
```


<!-- 4. How many customers never made a purchase, i.e., they appear in the customers table but not in the invoices table. -->
```{sql connection=dbcon}
SELECT COUNT(Customerid) as 'Number of Customers with no purchase' 
FROM customers 
WHERE Customerid NOT IN(SELECT Customerid FROM invoices);
```


<!-- 5. What are the names of the albums containing the substring "symphony" in the album title? -->
```{sql connection=dbcon}
SELECT Title FROM albums 
WHERE title LIKE '%symphony%';
```

<!-- 6. What is the total "price" of all tracks per artist, i.e., add up the "UnitPrice" column in tracks? -->
```{sql connection=dbcon}
SELECT ar.Name AS 'Artist Name', SUM(t.UnitPrice) as 'Total Price of Tracks' 
FROM tracks AS t 
INNER JOIN albums AS al ON t.AlbumId=al.AlbumId 
INNER JOIN artists AS ar ON al.Artistid=ar.Artistid 
GROUP BY ar.Artistid, ar.Name;
```

<!-- 7. Which artist(s) published the most tracks, regardless of type and format? List the artist(s) name(s).-->
```{sql connection=dbcon}
SELECT ar.Name AS 'Artist with most tracks'
FROM tracks AS t 
INNER JOIN albums AS al
ON t.Albumid = al.Albumid
INNER JOIN artists AS ar
ON al.Artistid = ar.Artistid   
GROUP BY ar.Artistid, ar.Name 
HAVING COUNT(t.Trackid) = 
(SELECT MAX(a.Number)
FROM
(SELECT COUNT(t.Trackid) AS 'Number'
FROM tracks AS t
INNER JOIN albums AS al
ON t.Albumid = al.Albumid
GROUP BY al.Artistid) AS a); 
```

<!-- 8. What is the total amount of music for each genre (in hours)? List the genre and time rounded to two decimals.-->
```{sql connection=dbcon}
SELECT g.Name AS 'Genre Name', ROUND(SUM(t.Milliseconds/3.6),2) AS 'Total Hours'
FROM tracks AS t
INNER JOIN genres AS g
ON t.Genreid = g.GenreId
GROUP BY g.GenreId, g.Name;
```

```{r}
dbDisconnect(dbcon)
```
